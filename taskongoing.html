<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tasquirre â€“ Task Ongoing</title>
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />

<style>
:root {
  --bg: #fff6e6;
  --bg-soft: #ffe8c7;
  --round-soft: #f1d2b2;
  --text-main: #5a2c13;
  --text-sub: #a96b3d;
  --accent: #c5652c;
  --accent-deep: #824119;
  --border-soft: #f0d4af;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif}

body{
  background:var(--bg);
  display:flex;
  justify-content:center;
  align-items:flex-start;
  min-height:100vh;
  padding:1.5rem 0;
}

.screen{
  width:100%;
  max-width:428px;
  min-height:100vh;
  background:var(--bg);
  padding-bottom:2.4rem;
  overflow-y:auto;
  transition:opacity .45s ease,filter .45s ease;
}

.screen.fade-out{
  opacity:0;
  filter:blur(10px);
}

/* HEADER */
.app-header{
  display:flex;
  justify-content:left;
  align-items:center;
  padding:0.8rem 1.1rem;
  gap:0.6rem;
}

.back-btn{
  width:42px;height:42px;
  display:flex;
  justify-content:center;align-items:center;
  background:var(--round-soft);
  border:none;
  border-radius:50%;
  font-size:1.3rem;
  cursor:pointer;
  color:var(--accent);
}

.header-title{
  font-size:1.2rem;
  font-weight:700;
  color:var(--accent);
}

/* CONTENT */
.card{
  background:#fff;
  margin:0.4rem 1.1rem 1.1rem;
  padding:1.1rem;
  border-radius:18px;
  box-shadow:0 6px 16px rgba(0,0,0,.08);
}

.label{
  font-size:0.78rem;
  color:var(--text-sub);
  margin-bottom:3px;
}

.value{
  font-size:0.95rem;
  color:var(--text-main);
  font-weight:500;
}

.job-title{
  font-size:1.05rem;
  font-weight:600;
  color:var(--text-main);
  margin-bottom:0.3rem;
}

/* PROGRESS */
.progress-wrap{
  margin-top:0.8rem;
}

.progress-top{
  display:flex;
  justify-content:space-between;
  font-size:0.8rem;
  color:var(--text-sub);
}

.progress-bar{
  width:100%;
  height:10px;
  background:#ffe8c7;
  border-radius:999px;
  overflow:hidden;
  margin-top:0.4rem;
}

.progress-fill{
  height:10px;
  background:linear-gradient(90deg,#c5652c,#824119);
  width:0;
  transition:0.35s;
}

/* BUTTONS */
.btn-row{
  display:flex;
  flex-direction:column;
  gap:0.6rem;
  margin-top:1rem;
}

.btn-pill{
  width:100%;
  padding:0.65rem 0;
  border-radius:999px;
  border:none;
  font-size:0.85rem;
  font-weight:600;
  cursor:pointer;
}

.btn-primary{
  background:linear-gradient(145deg,#c5652c,#f4984a);
  color:#fff;
}

.btn-secondary{
  background:#fff;
  border:1.4px solid var(--accent);
  color:var(--accent);
}

/* TOAST */
.toast-popup{
  position:fixed;
  top:-80px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(197,82,43,.92);
  padding:13px 18px;
  border-radius:18px;
  color:#fff;
  opacity:0;
  transition:.45s ease;
  z-index:9999;
}

.toast-popup.show{
  top:90px;
  opacity:1;
}
</style>
</head>
<body>

<div id="toast" class="toast-popup">Update</div>

<div class="screen" id="frame">

  <header class="app-header">
    <button class="back-btn" onclick="goBack()">
      <i class="bx bx-arrow-back"></i>
    </button>
    <div class="header-title">Task Ongoing</div>
  </header>

  <div class="card" id="taskCard">
    <!-- filled by JS -->
  </div>

</div>

<script>
function showToast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),1700);
}

/* SEED + LOAD TASK */
function seedPartnerTaskIfEmpty(){
  let t = localStorage.getItem("partnerTaskTasquirre");
  if(!t){
    const demo = {
      id:"TSQ-X71P9",
      jobdesk:"Copywriting 2 halaman A4",
      user:"Teresa",
      price:80000,
      status:"ongoing",
      progress:25,
      createdAt:Date.now()
    };
    localStorage.setItem("partnerTaskTasquirre", JSON.stringify(demo));
    return demo;
  }
  return JSON.parse(t);
}

let task = seedPartnerTaskIfEmpty();

/* RENDER CARD */
function render(){
  task = seedPartnerTaskIfEmpty();
  if(task.status==="submitted" || task.status==="waiting_confirm" || task.progress===100){
    // kalau sudah full, langsung ke submitted page
    const f=document.getElementById("frame");
    f.classList.add("fade-out");
    setTimeout(()=>window.location.href=`tasksubmitted.html?id=${encodeURIComponent(task.id)}`,450);
    return;
  }

  const card = document.getElementById("taskCard");
  const percent = task.progress || 0;
  const step = (percent/25)||0;
  const btnText = percent<100
      ? `Update Progress (${step}/4)`
      : "Sudah 100%";

  card.innerHTML = `
    <div class="job-title">${task.jobdesk}</div>

    <div style="margin-bottom:0.6rem;">
      <div class="label">Client</div>
      <div class="value">${task.user}</div>
    </div>

    <div style="margin-bottom:0.6rem;">
      <div class="label">Fee</div>
      <div class="value">Rp ${Number(task.price||0).toLocaleString("id-ID")}</div>
    </div>

    <div style="margin-bottom:0.6rem;">
      <div class="label">Task ID</div>
      <div class="value">${task.id}</div>
    </div>

    <div class="progress-wrap">
      <div class="progress-top">
        <span>Progress</span>
        <span id="progressText">${percent}%</span>
      </div>
      <div class="progress-bar">
        <div id="progressFill" class="progress-fill" style="width:${percent}%"></div>
      </div>
    </div>

    <div class="btn-row">
      <button class="btn-pill btn-primary" id="btnUpdate" ${percent>=100 ? "disabled style='opacity:.6;cursor:default;'" : ""} onclick="updateProgress()">
        ${btnText}
      </button>

      <button class="btn-pill btn-secondary" onclick="openChat()">
        Chat dengan User
      </button>
    </div>
  `;
}

/* UPDATE PROGRESS: 0 -> 25 -> 50 -> 75 -> 100 */
function updateProgress(){
  task = seedPartnerTaskIfEmpty();

  if(task.progress>=100){
    showToast("Task sudah 100%");
    return;
  }

  if(task.progress===0) task.progress = 25;
  else if(task.progress===25) task.progress = 50;
  else if(task.progress===50) task.progress = 75;
  else if(task.progress===75){
    task.progress = 100;
    task.status = "submitted";      // otomatis jadi submitted
  }

  localStorage.setItem("partnerTaskTasquirre", JSON.stringify(task));

  const pText = document.getElementById("progressText");
  const pFill = document.getElementById("progressFill");

  if(pText && pFill){
    pText.textContent = task.progress + "%";
    pFill.style.width = task.progress + "%";
  }

  if(task.progress<100){
    showToast("Progress diupdate ke " + task.progress + "%");
    render();
  } else {
    showToast("Task sudah 100%, kirim hasil ke user");
    setTimeout(()=>{
      const f=document.getElementById("frame");
      f.classList.add("fade-out");
      setTimeout(()=>window.location.href=`tasksubmitted.html?id=${encodeURIComponent(task.id)}`,450);
    }, 900);
  }
}

/* NAVIGATION */
function goBack(){
  const f=document.getElementById("frame");
  f.classList.add("fade-out");
  setTimeout(()=>window.location.href="activitiespartner.html",450);
}

function openChat(){
  const f=document.getElementById("frame");
  f.classList.add("fade-out");
  setTimeout(()=>window.location.href=`chatpartner.html?id=${encodeURIComponent(task.id)}`,450);
}

/* INIT */
render();
</script>
</body>
</html>
